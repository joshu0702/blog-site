var cursorPos = 0
$(function() {
	"use strict";

	$("#inputStory").blur(function(e){
		var storyData = $("#inputStory").html();
		$("#a-Story").val(storyData);
	});

	$(".eB").click(function(e){
		document.execCommand('bold');
	});

	$(".eH").click(function(e){
		document.execCommand('formatBlock',false,'<h3>');
	});

	$("#a-Submit").click(function(e){
		if($('#inputTitle').val() == "" || $('#inputSubTitle').val() == "" || $('#a-Story').val() == "" || $('#inputBanner').val() == "") {
			alert("Some Fields are Empty, Article not Saved");
			return false;
		}
	});

	$("#ls").click(function(e){
		if($('#le').val() == "avi" || $('#lp').val() == "pass123") {
			$("#mn").css("display","flex");
			$("#smn").css("display","none");
		} else {
			alert("Invalid Login Detail !");
		}
	});

	$(".eI").click(function(e){
		document.execCommand('italic');
	});

	$(".eU").click(function(e){
		document.execCommand('underline');
	});

	$(".eIm").click(function(e){
		loadImage();
	});

});

$(document).on('click', '.uploaded', function(e){
	var imgbase64 = $(e.currentTarget).parent().find("img").attr("src");
	var htm = $("#inputStory").html();
	$("#inputStory").html(htm+'<img src="'+imgbase64+'">');
});

var inputFileToLoad = $("#rawImageInput"),
		bindControl = false;
function loadImage() {
	inputFileToLoad.click();
	inputFileToLoad.change(function (){
		if(!bindControl) {
			bindControl = true; // Taking control
			loadImageFileAsURL();
		}
	});
}

function loadImageFileAsURL() {
	var filesSelected = inputFileToLoad[0].files;
	if (filesSelected.length > 0) {
	    var fileToLoad = filesSelected[0];
	    if (fileToLoad.type.match("image.*")) {
	        var fileReader = new FileReader();
	        fileReader.onload = function(fileLoadedEvent) {
					var imgNode = $(".imgBoxCont").append('<div class="card imgPrev"><img class="card-img" src="'+fileLoadedEvent.target.result+'"><div class="card-img-overlay uploaded"></div></div>');
					bindControl = false; // Releasing control
	        };
	        fileReader.readAsDataURL(fileToLoad);
	    }
	}
}



//------------------
var lock = false;
function ajx(jsonData,hois_func) {
	$.ajax({
		type: 'POST',
		url: '/admin/controller.php',
		data: { FormData: jsonData},
		cache: false,
		beforeSend: function() {
			lock = true;
		},
		complete: function() {
			lock = false;
		},
		success:hois_func,
		error: function(){
			lock = false;
			console.log("error");
		}
	});
}

function v(str) { // For debugging only
"use strict";
	if(!str) {
		console.log("Testing");
	}
	else {
		console.log(str);
	}
}
